<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statski</title>
    <link rel="stylesheet" href="../style/main.css">
    <link rel="stylesheet" href="../style/components.css">
</head>
<body>
    <div class="titlebar">Stratski</div>
    <div class="content">
        <div class="left-panel">
            <ul class="left-panel-options">
                <li class="left-panel-option"><a href="?">Some Option</a></li>
                <li class="left-panel-option"><a href="?">Some Option</a></li>
            </ul>
            <hr style="background-color: var(--color-clear-white); border-radius: var(--default-border-radius);">
            <button class="settings-button">Settings</button>
        </div>
        <div class="main-content">
            <div class="navbar">
                <ul class="navbar-items">
                    <li class="nav-item"><a href="?tab=mouse">Mouse</a></li>
                    <li class="nav-item"><a href="?tab=keyboard">Keyboard</a></li>
                </ul>
                <div class="navbar-right">
                    Profile
                </div>
            </div>
            <div class="statistic-preview">
                <canvas id="MouseHeatmap"></canvas>
            </div>
            <hr>
            <div class="control-panel">
                <ul class="control-buttons">
                    <li><button class="control-button cancel hidden" id="StopListening">Stop Listening</button></li>
                    <li><button class="control-button confirm" id="StartListening">Start Listening</button></li>
                    <li><label for="fetching">Fetch</label><input type="checkbox" name="fetching" id="FetchCheckbox" checked="True"></li>
                </ul>
            </div>
        </div>
    </div>
    <script src="../js/api_calls.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        const Canvas = document.getElementById("MouseHeatmap");
        const FetchCheckbox = document.getElementById("FetchCheckbox");
        let chunk_property = "times_hovered"
        let pixel_size = 2

        const intervalId = setInterval(() => {
            if (!FetchCheckbox.checked) {
                return;
            }
            fetch_chunk_data(chunk_property).then(data => {
                parse_chunk_data(data.body, Canvas, pixel_size);
            });
        }, 100);

        const StartListeningButton = document.getElementById("StartListening");
        StartListeningButton.onclick = () => {
            StartListeningButton.classList.add("hidden")
            StopListeningButton.classList.remove("hidden")
            start_listening()
        }
        const StopListeningButton = document.getElementById("StopListening");
        StopListeningButton.onclick = () => {
            StopListeningButton.classList.add("hidden")
            StartListeningButton.classList.remove("hidden")
            stop_listening().then(data => {
                parse_chunk_data(data.body, Canvas, pixel_size)
            })
        }
    </script>
</body>
</html>